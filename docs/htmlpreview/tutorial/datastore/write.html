<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using FeatureStore &mdash; GeoTools 13-SNAPSHOT User Guide</title>
    
    <link rel="stylesheet" href="../../_static/geotools.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '13-SNAPSHOT',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="GeoTools 13-SNAPSHOT User Guide" href="../../index.html" />
    <link rel="up" title="ContentDataStore Tutorial" href="index.html" />
    <link rel="next" title="Optimization" href="optimisation.html" />
    <link rel="prev" title="Implementing FeatureStore" href="store.html" /> 
  </head>
  <body role="document">
    <div class="header">
        <div class="wrap">
            <h1 id="logo"><a href="http://geotools.org">GeoTools</a></h1>
            <h1 id="logo_osgeo"><a href="http://osgeo.org">OSGeo</a></h1>
            <ul id="top-nav">
                <li class="first"><a href="http://docs.geotools.org">Documentation</a></li>
                <li><a href="http://sourceforge.net/projects/geotools/files">Downloads</a></li>
                <li><a href="http://docs.codehaus.org/display/GEOTOOLS/Home">Wiki</a></li>
                <li><a href="http://geotools.org/about.html">About</a></li>
                <li><a href="http://geotoolsnews.blogspot.com">Blog</a></li>
            </ul>
            <!--div id="searchbox">
                <form class="search" action="../../search.html" method="get">
                    <input id="searchbox-query" type="text" name="q" size="25" value="Search &hellip;" tabindex="3" onblur="if(this.value=='') this.value='Search &hellip;';" onfocus="if(this.value=='Search &hellip;') this.value='';" />
                    <input id="searchbox-submit" type="image" value="Search" src="../../_static/img/search_icon_green.png" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
            </div-->
        </div>
    </div>

    <div class="related">
      <ul id="breadcrumbs">
        <li><a href="../../index.html">GeoTools 13-SNAPSHOT User Guide</a> &raquo;</li>
          <li><a href="../index.html" >Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">ContentDataStore Tutorial</a> &raquo;</li>
        <li><a href="#">Using FeatureStore</a></li>
      </ul>
    </div> 

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using FeatureStore</a><ul>
<li><a class="reference internal" href="#featuresource">FeatureSource</a><ul>
<li><a class="reference internal" href="#featurestore">FeatureStore</a></li>
<li><a class="reference internal" href="#featurelocking">FeatureLocking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#featurewriter">FeatureWriter</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="store.html"
                        title="previous chapter">Implementing FeatureStore</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="optimisation.html"
                        title="next chapter">Optimization</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/tutorial/datastore/write.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-featurestore">
<h1>Using FeatureStore<a class="headerlink" href="#using-featurestore" title="Permalink to this headline">¶</a></h1>
<p>Now that we have completed our CSVDataStore implementation, we can explore the remaining
capabilities of the DataStore API.</p>
<p>DataStore actually extends DataAccess which was introduced to allow GeoTools to work with more
general content including properties, attributes and associations.</p>
<div class="figure" id="id1">
<img alt="../../_images/DataAccess.png" src="../../_images/DataAccess.png" />
<p class="caption"><span class="caption-text">DataAccess</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>DataStore, along with a few subclasses, are limited to work with SimpleFeature (values only, order
significant).</p>
<div class="figure" id="id2">
<img alt="../../_images/DataStore.png" src="../../_images/DataStore.png" />
<p class="caption"><span class="caption-text">DataStore</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>CSVDataStore API for data modification:</p>
<ul class="simple">
<li>CSVDataStore.createSchema( featureType )</li>
<li>CSVDataStore.getFeatureWriter( typeName, filter, Transaction )</li>
<li>CSVDataStore.getFeatureWriter( typeName, Transaction )</li>
<li>CSVDataStore.getFeatureWriterAppend( typeName, Transaction )</li>
<li>CSVDataStore.getFeatureSource( typeName )</li>
</ul>
<div class="section" id="featuresource">
<h2>FeatureSource<a class="headerlink" href="#featuresource" title="Permalink to this headline">¶</a></h2>
<p>The DataStore.getFeatureSource( typeName ) method is the gateway to our high level api, as
provided by an instance of FeatureSource, FeatureStore or FeatureLocking.</p>
<p>Now that we have implemented writing operations, the result of this method supports:</p>
<ul class="simple">
<li>FeatureSource: the query operations outlined in DataStore Tutorial 2: Use</li>
<li>FeatureStore: modification and transaction support</li>
<li>FeatureLocking: Interaction with a Feature-based Locking</li>
</ul>
<div class="section" id="featurestore">
<h3>FeatureStore<a class="headerlink" href="#featurestore" title="Permalink to this headline">¶</a></h3>
<p>FeatureStore provides Transaction support and modification operations. FeatureStore is an
extension of FeatureSource.</p>
<p>You may check the result of getFeatureSource( typeName ) with the instanceof operator.</p>
<p>Example of FeatureStore use:</p>
<p>FeatureStore defines:</p>
<ul class="simple">
<li>FeatureStore.addFeatures( featureReader)</li>
<li>FeatureStore.removeFeatures( filter )</li>
<li>FeatureStore.modifyFeatures( type, value, filter )</li>
<li>FeatureStore.modifyFeatures( types, values, filter )</li>
<li>FeatureStore.setFeatures( featureReader )</li>
<li>FeatureStore.setTransaction( transaction )</li>
</ul>
<p>Once again, many DataStores are able to provide optimized implementations of these operations.</p>
<p>Transaction Example:</p>
<p>This produces the following output:</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre>Step 1
------
start     auto-commit: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]
start              t1: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]
start              t2: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]

Step 2 transaction 1 removes feature &#39;fid1&#39;
------
t1 remove auto-commit: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]
t1 remove          t1: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]
t1 remove          t2: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]

Step 3 transaction 2 adds a new feature &#39;locations.1&#39;
------
t2 add    auto-commit: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]
t2 add             t1: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]
t1 add             t2: [locations.2, locations.3, new0, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]

Step 4 transaction 1 commits the removal of feature &#39;fid1&#39;
------
t1 commit auto-commit: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]
t1 commit          t1: [locations.2, locations.3, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]
t1 commit          t2: [locations.2, locations.3, new0, locations.1, locations.6, locations.7, locations.11, locations.4, locations.12, locations.5, locations.10, locations.8, locations.9]

Step 5 transaction 2 commits the addition of &#39;locations.1&#39;
------
t2 commit auto-commit: [locations.2, locations.3, locations.1, locations.13, locations.6, locations.7, locations.4, locations.11, locations.5, locations.12, locations.8, locations.9, locations.10]
t2 commit          t1: [locations.2, locations.3, locations.1, locations.13, locations.6, locations.7, locations.4, locations.11, locations.5, locations.12, locations.8, locations.9, locations.10]
t2 commit          t2: [locations.2, locations.3, locations.1, locations.13, locations.6, locations.7, locations.4, locations.11, locations.5, locations.12, locations.8, locations.9, locations.10]
</pre></div>
</div>
</div></blockquote>
<p>Resulting in the following file:</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre>LAT,LON,CITY,NUMBER,YEAR
11.116667,46.066667,Trento,140,2002
-93.0852,44.9441,St Paul,125,2003
100.493889,13.752222,Bangkok,150,2004
-75.69,45.420833,Ottawa,200,2004
-93.251867,44.9801,Minneapolis,350,2005
6.6335,46.519833,Lausanne,560,2006
-123.365556,48.428611,Victoria,721,2007
18.423889,-33.925278,Cape Town,550,2008
151.211111,-33.859972,Sydney,436,2009
2.183333,41.383333,Barcelona,914,2010
-104.984722,39.739167,Denver,869,2011
-1.133333,52.95,Nottingham,800,2013
45.52,-122.681944,Portland,800,2014
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Please review the above code example carefully as it is the best explanation
of transaction independence you will find.</p>
<p>Specifically:</p>
<ul class="last">
<li><p class="first">&#8220;auto-commit&#8221; represents the current contents of the file on disk</p>
</li>
<li><p class="first">Notice how the transactions only reflect the changes the user made relative to
the current file contents.</p>
<p>This is shown after t1 commit, where transaction t2 is seeing 4 features (ie the
current file contents plus the one feature that has been added on t2).</p>
</li>
<li><p class="first">This really shows that FeatureSource and FeatureStore are &#8220;views&#8221; into your data.</p>
<p>If you configure two FeatureStores with the same transaction they will act the same.</p>
<p>Transaction is important and represents what you are working on FeatureStore is not as
important and is just used to make working with your data easier (or more efficient)
than direct use of FeatureWriter.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="featurelocking">
<h3>FeatureLocking<a class="headerlink" href="#featurelocking" title="Permalink to this headline">¶</a></h3>
<p>FeatureLocking is the last extension to our high-level API. It provides support for preventing
modifications to features for the duration of a Transaction, or a period of time.</p>
<p>FeatureLocking defines:</p>
<ul class="simple">
<li>FeatureLocking.setFeatureLock( featureLock )</li>
<li>FeatureLocking.lockFeatures( query ) - lock features specified by query</li>
<li>FeatureLocking.lockFeatures( filter ) - lock according to constraints</li>
<li>FeatureLocking.lockFeatures() - lock all</li>
<li>FeatureLocking.unLockFeatures( query )</li>
<li>FeatureLocking.unLockFeatures( filter )</li>
<li>FeatureLocking.unLockFeatures()</li>
<li>FeatureLocking.releaseLock( string )</li>
<li>FeatureLocking.refreshLock( string )</li>
</ul>
<p>The concept of a FeatureLock matches the description provided in the OGC Web Feature Server
Specification. Locked Features can only be used via Transactions that have been provided with
the correct authorization.</p>
</div>
</div>
<div class="section" id="featurewriter">
<h2>FeatureWriter<a class="headerlink" href="#featurewriter" title="Permalink to this headline">¶</a></h2>
<p>The <strong>DataStore.getFeatureWriter( typeName, filter, transaction )</strong> method
creates a FeatureWriter used to modify features indicated by a constraint.</p>
<p>Example - removing all features:</p>
<p>This produces the following output:</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre>remove locations.1
remove locations.2
remove locations.3
remove locations.4
remove locations.5
remove locations.6
remove locations.7
remove locations.8
remove locations.9
remove locations.10
remove locations.11
remove locations.12
commit locations
</pre></div>
</div>
</div></blockquote>
<p>And the following file:</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre>LAT,LON,CITY,NUMBER,YEAR
</pre></div>
</div>
</div></blockquote>
<p>This FeatureWriter does not allow the addition of new content. It can be used for modification
and removal only. DataStores can often provide an optimized implementation.</p>
<p>The <strong>DataStore.getFeatureWriter( typeName, transaction )</strong> method creates a general purpose
FeatureWriter. New content may be added after iterating through the
provided content.</p>
<p>Example - completely replace all features:</p>
<p>The modified file:</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre>LAT,LON,CITY,NUMBER,YEAR
45.52,-122.681944,Portland,800,2014
</pre></div>
</div>
</div></blockquote>
<p>The <strong>DataStore.getFeatureWriterAppend( typeName, transaction )</strong> method creates a FeatureWriter
for adding content.</p>
<p>Example - making a copy:</p>
<p>The modified file:</p>
<blockquote>
<div><div class="highlight-text"><div class="highlight"><pre>LAT,LON,CITY,NUMBER,YEAR
11.116667,46.066667,Trento,140,2002
-93.0852,44.9441,St Paul,125,2003
100.493889,13.752222,Bangkok,150,2004
-75.69,45.420833,Ottawa,200,2004
-93.251867,44.9801,Minneapolis,350,2005
6.6335,46.519833,Lausanne,560,2006
-123.365556,48.428611,Victoria,721,2007
18.423889,-33.925278,Cape Town,550,2008
151.211111,-33.859972,Sydney,436,2009
2.183333,41.383333,Barcelona,914,2010
-104.984722,39.739167,Denver,869,2011
-1.133333,52.95,Nottingham,800,2013
</pre></div>
</div>
</div></blockquote>
<p>DataStores can often provide an optimized implementation of this method.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <ul id="breadcrumbs">
            <li class="right" style="margin-right: 10px">
              <a href="optimisation.html" title="Optimization"
                 accesskey="N">next</a></li>
            <li class="right" >
              <a href="store.html" title="Implementing FeatureStore"
                 accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">GeoTools 13-SNAPSHOT User Guide</a> &raquo;</li>
          <li><a href="../index.html" >Tutorials</a> &raquo;</li>
          <li><a href="index.html" >ContentDataStore Tutorial</a> &raquo;</li>
        <li><a href="#">Using FeatureStore</a></li>
      </ul>
    </div> 

    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, GeoTools.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b1.
    </div>
  </body>
</html>