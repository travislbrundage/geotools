<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Image Moasic JDBC &mdash; GeoTools 13-SNAPSHOT User Guide</title>
    
    <link rel="stylesheet" href="../../../_static/geotools.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '13-SNAPSHOT',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="GeoTools 13-SNAPSHOT User Guide" href="../../../index.html" />
    <link rel="up" title="Coverage" href="../index.html" />
    <link rel="next" title="Image Moasic JDBC Design" href="internal.html" />
    <link rel="prev" title="ImageIO-EXT GDAL Plugin" href="../imageio.html" /> 
  </head>
  <body role="document">
    <div class="header">
        <div class="wrap">
            <h1 id="logo"><a href="http://geotools.org">GeoTools</a></h1>
            <h1 id="logo_osgeo"><a href="http://osgeo.org">OSGeo</a></h1>
            <ul id="top-nav">
                <li class="first"><a href="http://docs.geotools.org">Documentation</a></li>
                <li><a href="http://sourceforge.net/projects/geotools/files">Downloads</a></li>
                <li><a href="http://docs.codehaus.org/display/GEOTOOLS/Home">Wiki</a></li>
                <li><a href="http://geotools.org/about.html">About</a></li>
                <li><a href="http://geotoolsnews.blogspot.com">Blog</a></li>
            </ul>
            <!--div id="searchbox">
                <form class="search" action="../../../search.html" method="get">
                    <input id="searchbox-query" type="text" name="q" size="25" value="Search &hellip;" tabindex="3" onblur="if(this.value=='') this.value='Search &hellip;';" onfocus="if(this.value=='Search &hellip;') this.value='';" />
                    <input id="searchbox-submit" type="image" value="Search" src="../../../_static/img/search_icon_green.png" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
            </div-->
        </div>
    </div>

    <div class="related">
      <ul id="breadcrumbs">
        <li><a href="../../../index.html">GeoTools 13-SNAPSHOT User Guide</a> &raquo;</li>
          <li><a href="../../index.html" >Library</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Coverage</a> &raquo;</li>
        <li><a href="#">Image Moasic JDBC</a></li>
      </ul>
    </div> 

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Image Moasic JDBC</a><ul>
<li><a class="reference internal" href="#example-use">Example Use</a></li>
<li><a class="reference internal" href="#mapping-of-table-and-attribute-names">Mapping of table and attribute names</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#jdbc-connect-configuration">JDBC Connect configuration</a></li>
<li><a class="reference internal" href="#map-configuration">Map Configuration</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../imageio.html"
                        title="previous chapter">ImageIO-EXT GDAL Plugin</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="internal.html"
                        title="next chapter">Image Moasic JDBC Design</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/library/coverage/jdbc/index.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="image-moasic-jdbc">
<span id="im-jdbc"></span><h1>Image Moasic JDBC<a class="headerlink" href="#image-moasic-jdbc" title="Permalink to this headline">¶</a></h1>
<p>This <strong>gt-imagemoasic-jdbc</strong> plugin is intended to handle large images stored as tiles in a JDBC
database. Tiles created by pyramids are also stored in the database. The utility uses the indexing
of databases to speed up access to the requested tiles, the plugin for itself has a multithreaded
architecture to make use of dual/quad core CPUs and multiprocessor systems.</p>
<div class="sidebar">
<p class="first sidebar-title">Details</p>
<div class="toctree-wrapper last compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="internal.html">Image Moasic JDBC Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="customized.html">Custom JDBC Access for Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Image Moasic JDBC FAQ</a></li>
</ul>
</div>
</div>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup Example</a></li>
</ul>
</div>
<p>This plugin should give you the possibility to handle large images with their pyramids in a JDBC database.</p>
<p>Credits:</p>
<ul class="simple">
<li>This module was funded by Google as part of the GSOC 08 program.</li>
</ul>
<p>Tested Database Systems</p>
<ul class="simple">
<li>DB2 (with or without Spatial Extender)</li>
<li>Oracle (with or without Location Based Services, Oracle Spatial not needed)</li>
<li>MySql</li>
<li>Postgres (with or without Postgis)</li>
<li>H2</li>
</ul>
<div class="section" id="example-use">
<h2>Example Use<a class="headerlink" href="#example-use" title="Permalink to this headline">¶</a></h2>
<p>This example shows how to use the module:</p>
<div class="highlight-python"><div class="highlight"><pre>// First, get a reader
// the configUrl references the config xml&amp;nbsp; and is object of one of the following types
// 1) java.net.URL
// 2) java.io.File
// 3) java.lang.String (A filename string or an url string)


AbstractGridFormat format =(AbstractGridFormat)GridFormatFinder.findFormat(configUrl);
ImageMosaicJDBCReader reader= (ImageMosaicJDBCReader)format.getReader(configUrl,null);

// get a parameter object for a grid geometry
ParameterValue&lt;GridGeometry2D&gt;gg=AbstractGridFormat.READ_GRIDGEOMETRY2D.createValue();

// create an envelope, 2 Points, lower left and upper right, x,y order
GeneralEnvelope envelope = new GeneralEnvelope(new double[] {10,20},new double[] {30,40});

// set a CRS for the envelope
envelope.setCoordinateReferenceSystem(CRS.decode&quot;EPSG:4326&quot;);

// Set the envelope into the parameter object
gg.setValue(new GridGeometry2D(new GeneralGridRange(new Rectangle(0, 0, width, heigth)),envelope));

// create a parameter Object for the background color (NODATA), this param is optional
final ParameterValue outTransp=ImageMosaicJDBCFormat.BACKGROUND_COLOR.createValue();
outTransp.setValue(Color.WHITE);

// if you like a transparent background, use this
// final ParameterValue outTransp=ImageMosaicJDBCFormat.OUTPUT_TRANSPARENT_COLOR.createValue();
// outTransp.setValue(Color.WHITE);

// call the plugin passing an array with the two parameter objects
try {
    GridCoverage2D coverage = (GridCoverage2D) reader.read(new GeneralParameterValue[] { gg, outTransp});
} catch (IOException e) {
    e.printStackTrace();
}
</pre></div>
</div>
</div>
<div class="section" id="mapping-of-table-and-attribute-names">
<h2>Mapping of table and attribute names<a class="headerlink" href="#mapping-of-table-and-attribute-names" title="Permalink to this headline">¶</a></h2>
<p>Since there a lot of naming conventions in different enterprises, I is not idea to force the use of predefined table and attribute names. In our example, the names of the spatial and tile tables is selectable, the name of the meta table and all the attribute names were assumed. The mapping of these names is part of the XML configuration. The corresponding XML fragment shows the mapping of the assumed names.</p>
<p>A sample XML fragment file <strong>mapping.xml.inc</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;!-- possible values: universal,postgis,db2,mysql,oracle --&gt;
&lt;spatialExtension name=&quot;universal&quot;/&gt;
&lt;mapping&gt;
      &lt;masterTable name=&quot;META&quot; &gt;
          &lt;coverageNameAttribute name=&quot;Name&quot;/&gt;
          &lt;maxXAttribute name=&quot;MaxX&quot;/&gt;
          &lt;maxYAttribute name=&quot;MaxY&quot;/&gt;
          &lt;minXAttribute name=&quot;MinX&quot;/&gt;
          &lt;minYAttribute name=&quot;MinY&quot;/&gt;
          &lt;resXAttribute name=&quot;ResX&quot;/&gt;
          &lt;resYAttribute name=&quot;RresY&quot;/&gt;
          &lt;tileTableNameAtribute    name=&quot;TileTable&quot; /&gt;
          &lt;spatialTableNameAtribute name=&quot;SpatialTable&quot; /&gt;
      &lt;/masterTable&gt;
      &lt;tileTable&gt;
          &lt;blobAttributeName name=&quot;Data&quot; /&gt;
          &lt;keyAttributeName name=&quot;Location&quot; /&gt;
      &lt;/tileTable&gt;
      &lt;spatialTable&gt;
          &lt;keyAttributeName name=&quot;Location&quot; /&gt;
          &lt;geomAttributeName name=&quot;Geom&quot; /&gt;
          &lt;tileMaxXAttribute name=&quot;MaxX&quot;/&gt;
          &lt;tileMaxYAttribute name=&quot;MaxY&quot;/&gt;
          &lt;tileMinXAttribute name=&quot;MinX&quot;/&gt;
          &lt;tileMinYAttribute name=&quot;MinY&quot;/&gt;
      &lt;/spatialTable&gt;
&lt;/mapping&gt;
</pre></div>
</div>
<p>The structure of this XML Fragment is kept very simple, use it as a pattern.</p>
<p>The name attribute of the &lt;spatialExtension&gt; has to be one of the following values</p>
<ul class="simple">
<li>universal (a vendor neutral JDBC approach which should work with any jdbc database with BLOB support)</li>
<li>db2 (use spatial extender)</li>
<li>mysql (use the spatial features of mysql)</li>
<li>postgis (use the spatial features of postgis)</li>
<li>oracle (use location based services included in every oracle edition, no oracle spatial needed !!!)</li>
</ul>
<p>If your spatial extension is universal you need to specify &lt;tileMinXAttribute&gt;,&lt;tileMinYAttribute&gt;,&lt;tileMaxXAttribute&gt;,&lt;tileMaxYAttribute&gt;, but you can omit &lt;geomAttributeName&gt;.</p>
<p>In all other cases, you need the &lt;geomAttributeName&gt; Element and can omit &lt;tileMinXAttribute&gt;,&lt;tileMinYAttribute&gt;,&lt;tileMaxXAttribute&gt;,&lt;tileMaxYAttribute&gt;.</p>
<p>Be careful with the case sensitivity of different DBMS products. Look here <a class="reference external" href="http://www.alberton.info/dbms_identifiers_and_case_sensitivity.html">http://www.alberton.info/dbms_identifiers_and_case_sensitivity.html</a> and here <a class="reference external" href="http://en.wikibooks.org/wiki/SQL_dialects_reference/Data_structure_definition/Delimited_identifiers">http://en.wikibooks.org/wiki/SQL_dialects_reference/Data_structure_definition/Delimited_identifiers</a>.</p>
<p>In the above example, we have  &lt;maxXAttribute name=&#8221;MaxX&#8221;/&gt; which will result in an attribute name of MAXX for DB2 and Oracle, but maxx for postgres. A good strategy would be to use identifiers (table and attribute Names ) consisting of uppercase /lowercase letters, depending on your DBMS.</p>
<p>This approach assures that there are no predefined table and attribute names, allowing seamless integration into existing naming conventions.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Each Map with its pyramids is configured by an XML File. The Configuration can be split into 3 parts</p>
<ol class="arabic simple">
<li>The database mapping as explained above</li>
<li>The JDBC connect configuration</li>
<li>The Map configuration</li>
</ol>
</div>
<div class="section" id="jdbc-connect-configuration">
<h2>JDBC Connect configuration<a class="headerlink" href="#jdbc-connect-configuration" title="Permalink to this headline">¶</a></h2>
<p>Dependent on the deployment environment, there are different possibilities for connection to the database. Using this plugin in a client java application will require a JDBC Driver Connect, operation within a J2EE Container should prefer a JNDI Datasource connect (your admin will be happy) .</p>
<p>A sample XML fragment file for a JDBC Driver Connection to the H2 database <strong>connect.xml.inc</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;connect&gt;
      &lt;dstype value=&quot;DBCP&quot;/&gt;
      &lt;username value=&quot;user&quot; /&gt;
      &lt;password value=&quot;password&quot; /&gt;
      &lt;jdbcUrl value=&quot;jdbc:h2:target/h2/testdata&quot; /&gt;
      &lt;driverClassName value=&quot;org.h2.Driver&quot;/&gt;
      &lt;maxActive value=&quot;10&quot;/&gt;
      &lt;maxIdle value=&quot;0&quot;/&gt;
&lt;/connect&gt;
</pre></div>
</div>
<p>XML Fragment for connection to a JNDI Datasource <strong>connect.xml.inc</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;connect&gt;
      &lt;dstype value=&quot;JNDI&quot;/&gt;
       &lt;jndiReferenceName value=&quot;jdbc/myDataSourceName&quot;/&gt;
&lt;/connect&gt;
</pre></div>
</div>
</div>
<div class="section" id="map-configuration">
<h2>Map Configuration<a class="headerlink" href="#map-configuration" title="Permalink to this headline">¶</a></h2>
<p>Now we can put the things together and create the config file for a map.</p>
<p>Example file map.xml:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!DOCTYPE ImageMosaicJDBCConfig [
   &lt;!ENTITY mapping PUBLIC &quot;mapping&quot; &quot;mapping.xml.inc&quot;&gt;
   &lt;!ENTITY connect PUBLIC &quot;connect&quot; &quot;connect.xml.inc&quot;&gt;
]&gt;


&lt;config version=&quot;1.0&quot;&gt;
   &lt;coverageName name=&quot;oek&quot;/&gt;
   &lt;coordsys name=&quot;EPSG:31287&quot;/&gt;
   &lt;!-- interpolation 1 = nearest neighbour, 2 = bipolar, 3 = bicubic --&gt;
   &lt;scaleop interpolation=&quot;1&quot;/&gt;
   &lt;axisOrder ignore=&quot;false&quot;/&gt;
   &lt;verify cardinality=&quot;false&quot;/&gt;
   &amp;mapping;
   &amp;connect;
&lt;/config&gt;
</pre></div>
</div>
<p>The DOCTYPE includes two XML entity references to the connct.xml.inc and mapping.xml.inc. The XML parser includes these fragments at parsing time.</p>
<p>Elements:</p>
<dl class="docutils">
<dt>config</dt>
<dd>The root element. The version attribute is reserved for future versions of this plugin. Must be &#8220;1.0.&#8221;</dd>
<dt>coverageName</dt>
<dd>The name of your map. This name is used for searching the meta data in the meta table.</dd>
<dt>coordsys</dt>
<dd>The name of a coordinate reference system, will be referenced by CRS.decode() of the geotools library.</dd>
<dt>scaleop</dt>
<dd>The interpolation method to use (1 = nearest neighbour, 2 = bipolar, 3 = bicubic)</dd>
<dt>axisOrder</dt>
<dd>The module compares the CRS from the read request to the CRS stored in the configuration. If the axis order differ, an x axis switch is performed.
Some clients are doing this before calling the module and the plugin switches again resulting in the original envelope. A value of &#8220;true&#8221; suppresses this switch.</dd>
<dt>verify</dt>
<dd>if you have image data and georeferencing information in different tables and the the attribute cardinality is true , the plugin will check the number of records in each table. If the numbers are not equal, the image/pyramid will be removed and you see a warning in the log. This check is intended for testing environments, set the value to false in production environments to avoid bad performance.</dd>
</dl>
<p><strong>Configuration Summary</strong></p>
<p>A map configuration consists of 3 parts, connect configuration, mapping configuration and map configuration. As a result, you have great flexibilty and can reuse parts of the configuration for many maps.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <ul id="breadcrumbs">
            <li class="right" style="margin-right: 10px">
              <a href="internal.html" title="Image Moasic JDBC Design"
                 accesskey="N">next</a></li>
            <li class="right" >
              <a href="../imageio.html" title="ImageIO-EXT GDAL Plugin"
                 accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">GeoTools 13-SNAPSHOT User Guide</a> &raquo;</li>
          <li><a href="../../index.html" >Library</a> &raquo;</li>
          <li><a href="../index.html" >Coverage</a> &raquo;</li>
        <li><a href="#">Image Moasic JDBC</a></li>
      </ul>
    </div> 

    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, GeoTools.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b1.
    </div>
  </body>
</html>